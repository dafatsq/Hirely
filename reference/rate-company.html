<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rate Company - HireLy</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      font-family: 'Inter', sans-serif;
    }
    
    :root {
      --radius: 20px;
      --glow-a: rgba(14,165,233,0.25);
      --glow-b: rgba(99,102,241,0.25);
    }

    body {
      background-color: #e9f3ff;
      background-image:
        radial-gradient(1400px 700px at 0% -20%, var(--glow-a), transparent 60%),
        radial-gradient(1400px 700px at 100% -20%, var(--glow-b), transparent 60%);
      background-repeat: no-repeat;
      background-attachment: fixed, fixed;
    }

    .card {
      border-radius: 20px;
      background: #ffffff;
      box-shadow: 0 10px 30px rgba(2, 6, 23, 0.10);
      border: 1px solid rgba(255,255,255,0.1);
    }

    .btn-primary {
      border-radius: 9999px;
      background: #0ea5e9;
      color: white;
      padding: 0.75rem 1.5rem;
      font-weight: 500;
      box-shadow: 0 10px 30px rgba(2, 6, 23, 0.10);
      transition: all 0.2s;
    }

    .btn-primary:hover {
      filter: brightness(1.1);
    }

    .btn-primary:active {
      filter: brightness(0.9);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-outline {
      border-radius: 9999px;
      background: transparent;
      color: #64748b;
      padding: 0.75rem 1.5rem;
      font-weight: 500;
      border: 1px solid #e2e8f0;
      transition: all 0.2s;
    }

    .btn-outline:hover {
      background: #f8fafc;
      border-color: #cbd5e1;
    }

    .input {
      width: 100%;
      border-radius: 12px;
      background: rgba(255,255,255,0.8);
      border: 1px solid #e2e8f0;
      padding: 0.875rem 1rem;
      outline: none;
      transition: all 0.2s;
    }

    .input:focus {
      border-color: #0ea5e9;
      box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
    }

    .company-item {
      border-radius: 12px;
      padding: 1rem;
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.2s;
    }

    .company-item:hover {
      border-color: #0ea5e9;
      background: rgba(14, 165, 233, 0.05);
    }

    .company-item.selected {
      border-color: #0ea5e9;
      background: rgba(14, 165, 233, 0.1);
    }

    .star-rating {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .star {
      cursor: pointer;
      font-size: 2rem;
      color: #cbd5e1;
      transition: all 0.2s;
    }

    .star:hover,
    .star.active {
      color: #fbbf24;
    }

    .review-card {
      border-radius: 16px;
      background: #ffffff;
      box-shadow: 0 4px 20px rgba(2, 6, 23, 0.08);
      border: 1px solid rgba(255,255,255,0.1);
      padding: 1.5rem;
    }

    .rating-display {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .rating-display .star-icon {
      color: #fbbf24;
      font-size: 1rem;
    }

    .rating-display .star-icon.empty {
      color: #cbd5e1;
    }

    .progress-indicator {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 9999;
      background: white;
      padding: 2rem;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .progress-indicator.active {
      display: block;
    }

    .spinner {
      border: 3px solid #f3f4f6;
      border-top: 3px solid #0ea5e9;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 9998;
    }

    .overlay.active {
      display: block;
    }
  </style>
</head>
<body class="text-slate-900">
  
  <!-- Navigation -->
  <nav class="p-6 md:p-8">
    <div class="card max-w-7xl mx-auto px-6 py-4">
      <div class="flex flex-wrap items-center gap-4 justify-between">
        <div class="flex items-center gap-8">
          <a href="index.html" class="text-2xl font-bold text-sky-500">HireLy</a>
          <div class="hidden md:flex gap-6 text-sm font-medium">
            <a href="index.html" class="text-slate-700 hover:text-sky-500 transition-colors">Home</a>
            <a href="jobs.html" class="text-slate-700 hover:text-sky-500 transition-colors">Jobs</a>
            <a href="saved-jobs.html" class="text-slate-700 hover:text-sky-500 transition-colors">Saved Jobs</a>
            <a href="applications.html" class="text-slate-700 hover:text-sky-500 transition-colors">Applications</a>
            <a href="profile.html" class="text-slate-700 hover:text-sky-500 transition-colors">Profile</a>
          </div>
        </div>
        <div class="flex items-center gap-3">
          <a href="login.html" class="btn-secondary hidden sm:block">Login</a>
          <a href="register.html" class="btn-primary">Create Account</a>
        </div>
      </div>
    </div>
  </nav>


  <!-- Main Content -->
  <section class="px-6 md:px-8 pb-12">
    <div class="max-w-4xl mx-auto">
      
      <!-- Header -->
      <div class="card p-6 md:p-8 mb-8">
        <h1 class="text-3xl font-bold mb-2">Rate Company</h1>
        <p class="text-slate-600">Share your experience and help others make informed decisions</p>
      </div>

      <!-- Step 1: Select Company -->
      <div id="stepSelectCompany" class="card p-6 md:p-8 mb-8">
        <h2 class="text-xl font-semibold mb-4">Select Company to Review</h2>
        
        <!-- Company List (companies user worked for or applied to) -->
        <div id="lstCompany" class="space-y-3">
          
          <!-- Company Option 1 -->
          <div class="company-item" data-company-id="1" data-company-name="TechCorp Indonesia">
            <div class="flex items-center gap-3">
              <input type="radio" name="company" value="1" class="w-5 h-5 text-sky-500">
              <div class="flex-1">
                <p class="font-semibold">TechCorp Indonesia</p>
                <p class="text-sm text-slate-500">Applied: Software Engineer - Sep 2025</p>
              </div>
            </div>
          </div>

          <!-- Company Option 2 -->
          <div class="company-item" data-company-id="2" data-company-name="Digital Solutions">
            <div class="flex items-center gap-3">
              <input type="radio" name="company" value="2" class="w-5 h-5 text-sky-500">
              <div class="flex-1">
                <p class="font-semibold">Digital Solutions</p>
                <p class="text-sm text-slate-500">Worked as: Frontend Developer - Jan 2024 to Aug 2025</p>
              </div>
            </div>
          </div>

          <!-- Company Option 3 -->
          <div class="company-item" data-company-id="3" data-company-name="StartupHub">
            <div class="flex items-center gap-3">
              <input type="radio" name="company" value="3" class="w-5 h-5 text-sky-500">
              <div class="flex-1">
                <p class="font-semibold">StartupHub</p>
                <p class="text-sm text-slate-500">Applied: Product Designer - Oct 2025</p>
              </div>
            </div>
          </div>

        </div>

        <div class="flex justify-end mt-6">
          <button id="btnContinue" class="btn-primary" disabled>
            Continue to Review
          </button>
        </div>
      </div>

      <!-- Step 2: Rating Form (Hidden initially) -->
      <div id="stepRatingForm" class="card p-6 md:p-8 mb-8 hidden">
        <h2 class="text-xl font-semibold mb-4">Rate <span id="selectedCompanyName">Company</span></h2>
        
        <!-- Error Label -->
        <div id="lblError" class="hidden bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
          <p class="text-sm text-red-600"></p>
        </div>

        <form id="reviewForm">
          <!-- Rating Input -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-slate-700 mb-3">Your Rating *</label>
            <div class="star-rating" id="ratingInput">
              <span class="star" data-rating="1">★</span>
              <span class="star" data-rating="2">★</span>
              <span class="star" data-rating="3">★</span>
              <span class="star" data-rating="4">★</span>
              <span class="star" data-rating="5">★</span>
              <span class="ml-3 text-slate-600" id="ratingText">Enter a rating 1-5</span>
            </div>
            <input type="hidden" id="ratingValue" name="ratingValue" value="0">
          </div>

          <!-- Review Text (Optional) -->
          <div class="mb-6">
            <label for="txtReview" class="block text-sm font-medium text-slate-700 mb-2">
              Your Review (Optional)
            </label>
            <textarea 
              id="txtReview"
              name="txtReview"
              class="input" 
              placeholder="Share your thoughts..."
              rows="6"
              maxlength="500"
            ></textarea>
            <div class="flex justify-between mt-2">
              <p class="text-xs text-slate-500">Maximum 500 characters</p>
              <p class="text-xs text-slate-500"><span id="charCount">0</span>/500</p>
            </div>
          </div>

          <!-- Progress Indicator -->
          <div id="progress" class="hidden mb-6">
            <div class="flex items-center justify-center gap-3 text-sky-500">
              <div class="spinner"></div>
              <span>Submitting your review...</span>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="flex gap-3 justify-end">
            <button type="button" id="btnCancel" class="btn-outline">
              Cancel
            </button>
            <button type="submit" id="btnSubmit" class="btn-primary" disabled>
              Submit Review
            </button>
          </div>
        </form>
      </div>

      <!-- Recent Reviews Section -->
      <div class="card p-6 md:p-8">
        <h2 class="text-xl font-semibold mb-6">Recent Reviews</h2>
        
        <div id="cardReview" class="space-y-4">
          
          <!-- Review Card 1 -->
          <div class="review-card">
            <div class="flex items-start justify-between mb-3">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-sky-400 to-sky-600 flex items-center justify-center text-white font-bold">
                  J
                </div>
                <div>
                  <p class="font-semibold">John Doe</p>
                  <p class="text-sm text-slate-500">TechCorp Indonesia</p>
                </div>
              </div>
              <div class="rating-display">
                <span class="star-icon">★</span>
                <span class="star-icon">★</span>
                <span class="star-icon">★</span>
                <span class="star-icon">★</span>
                <span class="star-icon empty">★</span>
                <span class="text-sm text-slate-600 ml-1">4.0</span>
              </div>
            </div>
            <p class="text-slate-700 text-sm leading-relaxed">
              Great company culture and work-life balance. The team is very supportive and management is transparent. Would recommend to anyone looking for a stable tech job.
            </p>
            <p class="text-xs text-slate-400 mt-3">2 days ago</p>
          </div>

          <!-- Review Card 2 -->
          <div class="review-card">
            <div class="flex items-start justify-between mb-3">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-400 to-purple-600 flex items-center justify-center text-white font-bold">
                  S
                </div>
                <div>
                  <p class="font-semibold">Sarah Smith</p>
                  <p class="text-sm text-slate-500">Digital Solutions</p>
                </div>
              </div>
              <div class="rating-display">
                <span class="star-icon">★</span>
                <span class="star-icon">★</span>
                <span class="star-icon">★</span>
                <span class="star-icon">★</span>
                <span class="star-icon">★</span>
                <span class="text-sm text-slate-600 ml-1">5.0</span>
              </div>
            </div>
            <p class="text-slate-700 text-sm leading-relaxed">
              Amazing place to grow your career! Learning opportunities are abundant and the projects are challenging yet rewarding. Highly recommend.
            </p>
            <p class="text-xs text-slate-400 mt-3">5 days ago</p>
          </div>

          <!-- Review Card 3 -->
          <div class="review-card">
            <div class="flex items-start justify-between mb-3">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-orange-400 to-orange-600 flex items-center justify-center text-white font-bold">
                  M
                </div>
                <div>
                  <p class="font-semibold">Mike Johnson</p>
                  <p class="text-sm text-slate-500">StartupHub</p>
                </div>
              </div>
              <div class="rating-display">
                <span class="star-icon">★</span>
                <span class="star-icon">★</span>
                <span class="star-icon">★</span>
                <span class="star-icon empty">★</span>
                <span class="star-icon empty">★</span>
                <span class="text-sm text-slate-600 ml-1">3.0</span>
              </div>
            </div>
            <p class="text-slate-700 text-sm leading-relaxed">
              Good for beginners but growth opportunities are limited. Fast-paced environment which can be stressful at times.
            </p>
            <p class="text-xs text-slate-400 mt-3">1 week ago</p>
          </div>

        </div>
      </div>

    </div>
  </section>

  <!-- Footer -->
  <footer class="px-6 md:px-8 pb-8">
    <div class="card max-w-7xl mx-auto p-8 md:p-12">
      <div class="grid md:grid-cols-4 gap-8 mb-8">
        <div>
          <h4 class="text-xl font-bold text-sky-500 mb-4">HireLy</h4>
          <p class="text-slate-600 text-sm">Your trusted partner in finding the perfect career opportunity.</p>
        </div>
        <div>
          <h5 class="font-semibold mb-3">For Job Seekers</h5>
          <ul class="space-y-2 text-sm text-slate-600">
            <li><a href="jobs.html" class="hover:text-sky-500">Browse Jobs</a></li>
            <li><a href="saved-jobs.html" class="hover:text-sky-500">Saved Jobs</a></li>
            <li><a href="applications.html" class="hover:text-sky-500">Track Applications</a></li>
            <li><a href="recommendations.html" class="hover:text-sky-500">Recommendations</a></li>
          </ul>
        </div>
        <div>
          <h5 class="font-semibold mb-3">Tools & Support</h5>
          <ul class="space-y-2 text-sm text-slate-600">
            <li><a href="profile.html" class="hover:text-sky-500">Profile</a></li>
            <li><a href="chatbot.html" class="hover:text-sky-500">Career Assistant</a></li>
            <li><a href="rate-company.html" class="hover:text-sky-500">Rate Companies</a></li>
            <li><a href="report-fraud.html" class="hover:text-sky-500">Report Fraud</a></li>
          </ul>
        </div>
        <div>
          <h5 class="font-semibold mb-3">Company</h5>
          <ul class="space-y-2 text-sm text-slate-600">
            <li><a href="post-job.html" class="hover:text-sky-500">Post a Job</a></li>
            <li><a href="verification.html" class="hover:text-sky-500">Verification</a></li>
            <li><a href="login.html" class="hover:text-sky-500">Employer Login</a></li>
            <li><a href="register.html" class="hover:text-sky-500">Create Account</a></li>
          </ul>
        </div>
      </div>
      <div class="pt-6 border-t border-slate-200 flex flex-col sm:flex-row justify-between items-center gap-4">
        <p class="text-sm text-slate-600">© 2025 HireLy. All rights reserved.</p>
        <div class="flex gap-4">
          <a href="#" class="w-10 h-10 rounded-full bg-slate-100 hover:bg-sky-100 flex items-center justify-center transition-colors">
            <svg class="w-5 h-5 text-slate-600" fill="currentColor" viewBox="0 0 24 24">
              <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
            </svg>
          </a>
          <a href="#" class="w-10 h-10 rounded-full bg-slate-100 hover:bg-sky-100 flex items-center justify-center transition-colors">
            <svg class="w-5 h-5 text-slate-600" fill="currentColor" viewBox="0 0 24 24">
              <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
            </svg>
          </a>
          <a href="#" class="w-10 h-10 rounded-full bg-slate-100 hover:bg-sky-100 flex items-center justify-center transition-colors">
            <svg class="w-5 h-5 text-slate-600" fill="currentColor" viewBox="0 0 24 24">
              <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
            </svg>
          </a>
        </div>
      </div>
    </div>
  </footer>


  <script>
    // State management
    let selectedCompanyId = null;
    let selectedCompanyName = '';
    let currentRating = 0;
    let hasReviewedBefore = false;

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      checkUserLogin();
      setupEventListeners();
    });

    // Check if user is logged in (A1 - Pre-condition check)
    function checkUserLogin() {
      // In production, check actual login status
      const isLoggedIn = true; // Simulated
      
      if (!isLoggedIn) {
        showError('You must be logged in to rate companies. Please sign in first.');
        setTimeout(() => {
          window.location.href = 'login.html';
        }, 2000);
      }
    }

    // Setup event listeners
    function setupEventListeners() {
      // Company selection
      document.querySelectorAll('.company-item').forEach(item => {
        item.addEventListener('click', function() {
          const radio = this.querySelector('input[type="radio"]');
          radio.checked = true;
          selectCompany(this);
        });

        const radio = item.querySelector('input[type="radio"]');
        radio.addEventListener('change', function() {
          if (this.checked) {
            selectCompany(item);
          }
        });
      });

      // Continue button
      document.getElementById('btnContinue').addEventListener('click', function() {
        if (selectedCompanyId) {
          // Check if user already reviewed this company (A4 - Duplicate review)
          checkExistingReview(selectedCompanyId);
        }
      });

      // Star rating
      document.querySelectorAll('.star').forEach(star => {
        star.addEventListener('click', function() {
          const rating = parseInt(this.getAttribute('data-rating'));
          setRating(rating);
        });

        star.addEventListener('mouseenter', function() {
          const rating = parseInt(this.getAttribute('data-rating'));
          highlightStars(rating);
        });
      });

      document.getElementById('ratingInput').addEventListener('mouseleave', function() {
        highlightStars(currentRating);
      });

      // Character counter
      document.getElementById('txtReview').addEventListener('input', function() {
        const count = this.value.length;
        document.getElementById('charCount').textContent = count;

        // Filter bad words (business rule)
        const hasBadWords = checkProfanity(this.value);
        if (hasBadWords) {
          showError('Please avoid using profane language in your review.');
        }
      });

      // Form submission
      document.getElementById('reviewForm').addEventListener('submit', function(e) {
        e.preventDefault();
        submitReview();
      });

      // Cancel button
      document.getElementById('btnCancel').addEventListener('click', function() {
        resetForm();
      });
    }

    // Select company
    function selectCompany(item) {
      // Remove previous selection
      document.querySelectorAll('.company-item').forEach(el => {
        el.classList.remove('selected');
      });

      // Add selection
      item.classList.add('selected');
      selectedCompanyId = item.getAttribute('data-company-id');
      selectedCompanyName = item.getAttribute('data-company-name');

      // Enable continue button
      document.getElementById('btnContinue').disabled = false;
    }

    // Check if user already reviewed this company
    function checkExistingReview(companyId) {
      // In production, check via API
      // Simulating: user already reviewed company 1
      if (companyId === '1') {
        hasReviewedBefore = true;
        
        if (confirm('You have already reviewed this company. You can only submit one review per company. Would you like to edit your existing review?')) {
          showRatingForm();
          // In production, load existing review data
          showError('Note: Editing previous reviews is not yet implemented. You can only view your existing review.');
        }
      } else {
        hasReviewedBefore = false;
        showRatingForm();
      }
    }

    // Show rating form
    function showRatingForm() {
      document.getElementById('stepSelectCompany').classList.add('hidden');
      document.getElementById('stepRatingForm').classList.remove('hidden');
      document.getElementById('selectedCompanyName').textContent = selectedCompanyName;
      
      // Validate form on step 2 load
      validateForm();
      
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Set rating
    function setRating(rating) {
      currentRating = rating;
      document.getElementById('ratingValue').value = rating;
      highlightStars(rating);
      
      const ratingText = document.getElementById('ratingText');
      const texts = ['', 'Poor', 'Fair', 'Good', 'Very Good', 'Excellent'];
      ratingText.textContent = texts[rating];
      
      // Validate form after rating change
      validateForm();
    }

    // Validate form and enable/disable submit button (DPPL: btnSubmit disabled until valid)
    function validateForm() {
      const submitBtn = document.getElementById('btnSubmit');
      const isValid = selectedCompanyId && currentRating >= 1 && currentRating <= 5;
      submitBtn.disabled = !isValid;
    }

    // Highlight stars
    function highlightStars(rating) {
      document.querySelectorAll('.star').forEach((star, index) => {
        if (index < rating) {
          star.classList.add('active');
        } else {
          star.classList.remove('active');
        }
      });
    }

    // Submit review
    function submitReview() {
      hideError();

      // A2 - Validation: Rating kosong
      if (currentRating === 0) {
        showError('Harap berikan nilai bintang');
        return;
      }

      // Get review text
      const reviewText = document.getElementById('txtReview').value.trim();

      // A3 - Validation: Profanity detected
      if (reviewText && checkProfanity(reviewText)) {
        showError('Ulasan berisi kata tidak sopan. Harap ganti kata yang terlarang dan coba lagi.');
        return;
      }

      // Validation: Character limit (Business Rule)
      if (reviewText.length > 500) {
        showError('Review text must not exceed 500 characters.');
        return;
      }

      // Show progress
      showProgress();

      // Simulate API call
      setTimeout(() => {
        // A5 - Server error simulation
        const serverAvailable = true; // Change to false to test error
        
        if (!serverAvailable) {
          hideProgress();
          showError('ReviewService gagal → sistem tampilkan "Gagal menyimpan, coba lagi nanti".');
          return;
        }

        // Success
        hideProgress();
        
        // In production, send data to ReviewService
        const reviewData = {
          companyId: selectedCompanyId,
          userId: 'user123', // From logged-in user
          rating: currentRating,
          comment: reviewText,
          createdAt: new Date().toISOString()
        };

        console.log('Review submitted:', reviewData);
        console.log('ReviewController → ReviewService → Company entity updated');
        console.log('Company avgRating and reviewCount updated');

        // Show success message
        alert('Review submitted successfully! Thank you for sharing your experience.');

        // Reset and show recent reviews with new entry
        addNewReviewToList(reviewData);
        resetForm();
        
        // Scroll to recent reviews
        document.getElementById('cardReview').scrollIntoView({ behavior: 'smooth' });
      }, 2000);
    }

    // Add new review to recent list
    function addNewReviewToList(reviewData) {
      const reviewList = document.getElementById('cardReview');
      const newReview = document.createElement('div');
      newReview.className = 'review-card';
      
      const stars = [];
      for (let i = 1; i <= 5; i++) {
        if (i <= reviewData.rating) {
          stars.push('<span class="star-icon">★</span>');
        } else {
          stars.push('<span class="star-icon empty">★</span>');
        }
      }

      newReview.innerHTML = `
        <div class="flex items-start justify-between mb-3">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-green-400 to-green-600 flex items-center justify-center text-white font-bold">
              Y
            </div>
            <div>
              <p class="font-semibold">You</p>
              <p class="text-sm text-slate-500">${selectedCompanyName}</p>
            </div>
          </div>
          <div class="rating-display">
            ${stars.join('')}
            <span class="text-sm text-slate-600 ml-1">${reviewData.rating}.0</span>
          </div>
        </div>
        <p class="text-slate-700 text-sm leading-relaxed">
          ${reviewData.comment || 'No written review provided.'}
        </p>
        <p class="text-xs text-slate-400 mt-3">Just now</p>
      `;

      reviewList.insertBefore(newReview, reviewList.firstChild);
    }

    // Check profanity (simplified)
    function checkProfanity(text) {
      // In production, use ModerationService with NLP
      const badWords = ['damn', 'hell', 'stupid', 'idiot']; // Example bad-word list
      const lowerText = text.toLowerCase();
      
      return badWords.some(word => lowerText.includes(word));
    }

    // Show error
    function showError(message) {
      const errorDiv = document.getElementById('lblError');
      const errorText = errorDiv.querySelector('p');
      errorText.textContent = message;
      errorDiv.classList.remove('hidden');
      errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    // Hide error
    function hideError() {
      const errorDiv = document.getElementById('lblError');
      errorDiv.classList.add('hidden');
    }

    // Show progress
    function showProgress() {
      document.getElementById('progress').classList.remove('hidden');
      document.getElementById('btnSubmit').disabled = true;
      document.getElementById('btnCancel').disabled = true;
    }

    // Hide progress
    function hideProgress() {
      document.getElementById('progress').classList.add('hidden');
      document.getElementById('btnCancel').disabled = false;
      // Don't re-enable submit here - let validateForm handle it
      validateForm();
    }

    // Reset form
    function resetForm() {
      document.getElementById('stepRatingForm').classList.add('hidden');
      document.getElementById('stepSelectCompany').classList.remove('hidden');
      
      // Clear form
      document.getElementById('txtReview').value = '';
      document.getElementById('charCount').textContent = '0';
      setRating(0);
      
      // Clear selection
      document.querySelectorAll('.company-item').forEach(el => {
        el.classList.remove('selected');
      });
      document.querySelectorAll('input[name="company"]').forEach(radio => {
        radio.checked = false;
      });
      
      selectedCompanyId = null;
      selectedCompanyName = '';
      document.getElementById('btnContinue').disabled = true;
      
      // Reset submit button to disabled
      document.getElementById('btnSubmit').disabled = true;
      
      hideError();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  </script>

</body>
</html>
